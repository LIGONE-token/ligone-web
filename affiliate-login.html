<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Affiliate Login – LIGONE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex" />

  <!-- Supabase (nur DB, kein Auth!) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js"></script>

  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      background:#0b0f14;
      color:#e8eef6;
    }
    .wrap{max-width:520px;margin:0 auto;padding:48px 20px}
    .card{
      background:#111826;
      border:1px solid #1f2a3a;
      border-radius:14px;
      padding:26px;
    }
    h1{margin-top:0}
    label{display:block;margin-top:14px}
    input{
      width:100%;
      padding:12px;
      margin-top:6px;
      border-radius:10px;
      border:1px solid #1f2a3a;
      background:#0e1524;
      color:#e8eef6;
      font-size:16px;
    }
    button{
      margin-top:20px;
      padding:12px 18px;
      border-radius:12px;
      border:none;
      background:linear-gradient(135deg,#1dd1a1,#10ac84);
      color:#06281f;
      font-size:16px;
      font-weight:600;
      cursor:pointer;
      width:100%;
    }
    .muted{color:#9fb0c3;font-size:14px}
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h1>Affiliate Login</h1>
    <p class="muted">Zugang nur für registrierte Affiliates.</p>

    <label>Benutzername</label>
    <input id="user" autocomplete="username">

    <label>Passwort</label>
    <input id="pass" type="password" autocomplete="current-password">

    <button onclick="login()">Einloggen</button>
  </div>
</div>

<script>
const SB_URL = "https://hwpeegcsdgxgcybuosfv.supabase.co";
const SB_KEY = "sb_publishable_LhuHoUS_DR4o2Pp3aqbNBw_IXwHo2fD";
const sb = supabase.createClient(SB_URL, SB_KEY);

async function login(){
  const u = document.getElementById("user").value.trim();
  const p = document.getElementById("pass").value;

  if(!u || !p) return alert("Bitte Benutzername und Passwort eingeben.");

  const { data, error } = await sb
    .from("affiliates")
    .select("username,password_hash,ref_code,commission,active")
    .eq("username", u)
    .eq("active", true)
    .single();

  if(error || !data) return alert("Login fehlgeschlagen.");

  if(!bcrypt.compareSync(p, data.password_hash))
    return alert("Login fehlgeschlagen.");

  // Session setzen
  localStorage.setItem("affiliate_session", JSON.stringify({
    ref_code: data.ref_code,
    commission: data.commission
  }));

  location.href = "affiliate-dashboard.html";
}
</script>
</body>
</html>
