name: Jackpot OG Image

on:
  schedule:
    - cron: '0 17 * * *'   # 18:00 Z√ºrich ‚âà 17:00 UTC
  workflow_dispatch:

jobs:
  render:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install Playwright (with deps)
        run: |
          npm init -y
          npm install playwright
          npx playwright install --with-deps chromium

      - name: Render OG image
        run: |
          node <<'EOF'
          const fs = require('fs');
const { chromium } = require('playwright');

const jackpot = JSON.parse(fs.readFileSync('jackpot.json', 'utf8'));

(async () => {
  const browser = await chromium.launch();
  const page = await browser.newPage({
    viewport: { width: 1200, height: 630 }
  });

  await page.goto('file://' + process.cwd() + '/og/jackpot.html');

  // üî• ZAHL DIREKT SETZEN
  await page.evaluate((amount) => {
    document.getElementById('jackpotValue').textContent = amount;
  }, jackpot.amount);

  await page.screenshot({
    path: process.cwd() + '/og/jackpot.png'
  });

  await browser.close();
})();

          EOF

      - name: Commit & push image
        run: |
          git config user.name "og-bot"
          git config user.email "bot@users.noreply.github.com"
          git add og/jackpot.png
          git commit -m "üñºÔ∏è Update OG jackpot image" || exit 0
          git push
