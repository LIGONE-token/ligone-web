name: Jackpot OG Image

on:
  schedule:
    - cron: '0 17 * * *'   # 18:00 Z√ºrich ‚âà 17:00 UTC
  workflow_dispatch:

jobs:
  render:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install Playwright (with deps)
        run: |
          npm init -y
          npm install playwright
          npx playwright install --with-deps chromium

      - name: Render OG image
        run: |
          node <<'EOF'
          const { chromium } = require('playwright');

          (async () => {
            const browser = await chromium.launch();
            const page = await browser.newPage({
              viewport: { width: 1200, height: 630 }
            });

            await page.goto('file://' + process.cwd() + '/og/jackpot.html');
            await page.waitForTimeout(1500);

            await page.screenshot({
              path: process.cwd() + '/og/jackpot.png'
            });

            await browser.close();
          })();
          EOF

      - name: Commit & push image
        run: |
          git config user.name "og-bot"
          git config user.email "bot@users.noreply.github.com"
          git add og/jackpot.png
          git commit -m "üñºÔ∏è Update OG jackpot image" || exit 0
          git push
