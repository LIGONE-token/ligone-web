name: Jackpot Draw (Zurich)

on:
  schedule:
    - cron: "0 18 * * *"
  workflow_dispatch:

jobs:
  draw:
    runs-on: ubuntu-latest
    env:
      TZ: Europe/Zurich   # ðŸ”‘ ENTSCHEIDEND

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run jackpot draw
        run: |
          node <<'EOF'
          const fs = require("fs");

          const FILE = "jackpot.json";
          const START = 10;
          const STEP = 10;

          const now = new Date();
          const today = now.toISOString().slice(0, 10);

          const data = JSON.parse(fs.readFileSync(FILE, "utf8"));

          if (data.lastDrawDate === today) {
            console.log("Ziehung fÃ¼r heute bereits erfolgt.");
            process.exit(0);
          }

          const winnerFound = Math.random() < 0.05; // 5 %

          data.winnerFound = winnerFound;
          data.lastDrawDate = today;
          data.jackpot = winnerFound ? START : data.jackpot + STEP;
          data.updatedAt = new Date().toISOString();

          fs.writeFileSync(FILE, JSON.stringify(data, null, 2));
          EOF

      - name: Commit jackpot update
        run: |
          git config user.name "jackpot-bot"
          git config user.email "jackpot@bot"
          git add jackpot.json
          git commit -m "ðŸŽ° Automatische Ziehung 18:00 ZÃ¼rich"
          git push
