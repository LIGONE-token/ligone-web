name: Amount Generator

on:
  schedule:
    - cron: '1 17 * * *' # 18:01 ZÃ¼rich (Winterzeit)
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Generate amount
        run: |
          mkdir -p data
          if [ ! -f data/amount.json ]; then
            echo '{ "amount": 20 }' > data/amount.json
          else
            node -e "
              const fs = require('fs');
              const d = JSON.parse(fs.readFileSync('data/amount.json','utf8'));
              d.amount = Number(d.amount) + 10;
              fs.writeFileSync('data/amount.json', JSON.stringify(d, null, 2));
            "
          fi

      - name: Commit & push
        run: |
          git config user.name 'amount-bot'
          git config user.email 'bot@users.noreply.github.com'
          git add data/amount.json
          git commit -m 'Auto amount update after draw' || exit 0
          git push
