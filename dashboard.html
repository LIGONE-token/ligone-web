<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>LIGONE – Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#f4f5f7;
      color:#1a1a1a;
    }

    .wrap{
  padding:28px 20px 30px;
}


    h1{
      margin:0 0 26px;
      font-size:26px;
      font-weight:700;
    }

    h2{
      margin:0 0 10px;
      font-size:18px;
      font-weight:700;
    }

    .muted{
      font-size:13px;
      color:#666;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      gap:18px;
      margin-bottom:28px;
    }

    .box{
      background:#fff;
      border-radius:14px;
      padding:18px 20px;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
    }

    /* Assets */
    .asset{
      font-size:20px;
      font-weight:700;
      margin-bottom:8px;
    }

    .asset-status{
      font-size:14px;
      color:#444;
      background:#f1f2f4;
      border-radius:10px;
      padding:12px;
    }

    /* KPI Block */
    .kpis{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:12px;
      margin-top:14px;
    }

    .kpi{
      background:#f7f7f8;
      border:1px solid #ececec;
      border-radius:12px;
      padding:12px 14px;
      text-align:left;
    }

    .kpi .label{
      font-size:12px;
      color:#666;
      font-weight:600;
      margin-bottom:6px;
    }

    .kpi .value{
      font-size:20px;
      font-weight:800;
      letter-spacing:-0.02em;
    }

    .kpi .sub{
      margin-top:6px;
      font-size:12px;
      color:#666;
    }

    .badge{
      display:inline-block;
      padding:4px 8px;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
      border:1px solid #e5e5e5;
      background:#fff;
      color:#333;
    }

    .row{
      margin-top:16px;
      padding-top:14px;
      border-top:1px solid #eee;
      display:grid;
      gap:8px;
      font-size:13px;
      color:#333;
    }

    .mono{
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
    }

    /* Kalender */
    .calendar{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:6px;
      margin-top:14px;
    }

    .day{
      background:#f1f2f4;
      border-radius:8px;
      padding:10px;
      min-height:70px;
      font-size:12px;
      color:#555;
    }

    footer{
      margin-top:40px;
      font-size:12px;
      color:#777;
      text-align:center;
    }
  </style>
</head>

<body>
<div class="wrap">

  <h1>LIGONE · Admin Dashboard</h1>

  <!-- ASSETS -->
  <div class="grid">
    <div class="box">
      <div class="asset">LIG1</div>
      <div class="asset-status">Entwicklung / Status (read-only)</div>
    </div>

    <div class="box">
      <div class="asset">LIGC</div>
      <div class="asset-status">Entwicklung / Status (read-only)</div>
    </div>

    <div class="box">
      <div class="asset">LIGX</div>
      <div class="asset-status">Entwicklung / Status (read-only)</div>
    </div>
  </div>

  <!-- SYSTEM -->
  <div class="grid">
    <div class="box">
      <h2>Systemstatus</h2>
      <div class="asset-status">
        Datenquellen · Automatiken · Stabilität
      </div>
    </div>
  </div>

  <!-- ZIEHUNGEN / JACKPOT -->
  <div class="grid">
    <div class="box">
      <h2>Ziehungen · Jackpot · Teilnehmer</h2>
      <div class="muted">Admin-Übersicht (read-only)</div>

      <div class="kpis">
        <div class="kpi">
          <div class="label">Aktueller Jackpot</div>
          <div class="value" id="dashJackpot">–</div>
          <div class="sub">amount.json</div>
        </div>

        <div class="kpi">
          <div class="label">Teilnehmer aktuell</div>
          <div class="value" id="dashParticipants">–</div>
          <div class="sub">Supabase participants</div>
        </div>

        <div class="kpi">
          <div class="label">Nächste Ziehung</div>
          <div class="value" id="dashNextDraw">–</div>
          <div class="sub">Zürich</div>
        </div>

        <div class="kpi">
  <div class="label">Automatik</div>
  <span class="badge" id="dashAutomation">unbekannt</span>
  <span class="badge">unbekannt</span>
  <div class="sub">Status</div>
</div>

      </div>

      <div class="row">
        <div><strong>Letzte Ziehung:</strong> <span id="dashLastDrawTime">–</span></div>
        <div><strong>Gewinner:</strong> <span class="mono" id="dashLastWinner">–</span></div>
<div><strong>Teilnehmer (bei Ziehung):</strong> <span id="dashLastDrawCount">–</span></div>
      </div>
    </div>
  </div>

  <!-- AKTIVITÄT -->
  <div class="grid">
    <div class="box">
      <h2>Aktivität & Interesse</h2>
      <div class="asset-status">
        Besucher · Teilnehmer · Trends
      </div>
    </div>
  </div>

  <!-- KALENDER -->
  <div class="box">
    <h2>Admin-Kalender & Ziele</h2>
    <div class="muted">Beobachtungsphasen · Reviews · bewusstes Nicht-Handeln</div>

    <div class="calendar">
      <div class="day">Mo</div>
      <div class="day">Di</div>
      <div class="day">Mi</div>
      <div class="day">Do</div>
      <div class="day">Fr</div>
      <div class="day">Sa</div>
      <div class="day">So</div>
    </div>
  </div>

  <!-- NOTIZEN -->
  <div class="box" style="margin-top:28px;">
    <h2>Beobachtungen & Notizen</h2>
    <div class="asset-status">
      Gedanken · Muster · Entscheidungen
    </div>
  </div>

  <footer>
    Internes Admin-Dashboard · beobachten · nicht eingreifen
  </footer>

</div>

  <script>
/* ============================
   KONFIGURATION
============================ */
const SUPABASE_URL = "https://hwpeegcsdgxgcybuosfv.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_LhuHoUS_DR4o2Pp3aqbNBw_IXwHo2fD";

/* ============================
   HILFSFUNKTIONEN
============================ */
function formatCHF(v){
  return new Intl.NumberFormat("de-CH", {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  }).format(v) + " €";
}

function nextDrawZurich(){
  const now = new Date(
    new Date().toLocaleString("en-US", { timeZone: "Europe/Zurich" })
  );
  const draw = new Date(now);
  draw.setHours(18,0,0,0);
  if(now >= draw) draw.setDate(draw.getDate() + 1);
  return draw.toLocaleString("de-CH");
}

/* ============================
   JACKPOT
============================ */
fetch("./data/amount.json?ts=" + Date.now())
  .then(r => r.json())
  .then(d => {
    const el = document.querySelector("#dashJackpot");
    if(el) el.textContent = formatCHF(d.amount);
  })
  .catch(() => {
    const el = document.querySelector("#dashJackpot");
    if(el) el.textContent = "–";
  });

/* ============================
   TEILNEHMER (COUNT)
============================ */
fetch(`${SUPABASE_URL}/rest/v1/participants?select=id`,{
  headers:{
    apikey: SUPABASE_ANON_KEY,
    Authorization:`Bearer ${SUPABASE_ANON_KEY}`
  }
})
.then(r => r.json())
.then(d => {
  const el = document.querySelector("#dashParticipants");
  if(el) el.textContent = d.length;
})
.catch(() => {
  const el = document.querySelector("#dashParticipants");
  if(el) el.textContent = "–";
});

/* ============================
   LETZTE ZIEHUNG
============================ */
fetch(
  `${SUPABASE_URL}/rest/v1/draws?select=draw_time,winner_wallet,participant_count&order=draw_time.desc&limit=1`,
  {
    headers:{
      apikey: SUPABASE_ANON_KEY,
      Authorization:`Bearer ${SUPABASE_ANON_KEY}`
    }
  }
)
.then(r => r.json())
.then(d => {
  if(!d || !d.length) return;

  const draw = d[0];

  const timeEl = document.querySelector("#dashLastDrawTime");
  const winEl  = document.querySelector("#dashLastWinner");
  const cntEl  = document.querySelector("#dashLastDrawCount");

  if(timeEl)
    timeEl.textContent = new Date(draw.draw_time).toLocaleString("de-CH");

  if(winEl)
    winEl.textContent =
      draw.winner_wallet.slice(0,6) + "…" + draw.winner_wallet.slice(-4);

  if(cntEl)
    cntEl.textContent = draw.participant_count;
});

/* ============================
   NÄCHSTE ZIEHUNG
============================ */
const nextEl = document.querySelector("#dashNextDraw");
if(nextEl) nextEl.textContent = nextDrawZurich();

/* ============================
   AUTOMATIK (vorerst statisch)
============================ */
const autoEl = document.querySelector("#dashAutomation");
if(autoEl){
  autoEl.textContent = "OK";
  autoEl.style.borderColor = "#cde7d8";
  autoEl.style.background = "#eef8f2";
  autoEl.style.color = "#1f7a3a";
}
</script>

</body>
  
</html>
