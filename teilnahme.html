<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Teilnahme ‚Äì LIGONE Gewinnspiel</title>
  <meta name="description" content="Teilnahme am LIGONE Gewinnspiel. Teilnahme nur mit LIG1 in der Wallet.">

  <!-- Google Analytics: HIER denselben Code einf√ºgen wie auf ligone-web -->

  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#f7f7f7;
      color:#1a1a1a;
      display:flex;
      justify-content:center;
    }
    .container{
      max-width:860px;
      width:94%;
      padding:28px 0 40px;
    }
    h1{margin-top:0;}
    a{color:#0b57d0;text-decoration:none;}
    a:hover{text-decoration:underline;}
    .box{
      background:#fff;
      padding:22px 20px;
      border-radius:12px;
      box-shadow:0 8px 22px rgba(0,0,0,0.08);
      margin-bottom:18px;
    }
    .participation{
      text-align:center;
      margin-top:10px;
    }
    button{
      padding:14px 26px;
      border-radius:10px;
      border:0;
      font-size:16px;
      font-weight:600;
      background:#111;
      color:#fff;
      cursor:pointer;
    }
    button:disabled{
      background:#777;
      cursor:default;
    }
    .status{
      margin-top:12px;
      font-weight:600;
    }
    details{
      margin:12px 0;
      padding:10px 12px;
      border:1px solid #ddd;
      border-radius:8px;
      background:#fafafa;
    }
    summary{
      cursor:pointer;
      font-weight:600;
    }
    pre{
      background:#eee;
      padding:8px;
      border-radius:6px;
      overflow-x:auto;
    }
    .note{
      font-size:13px;
      color:#555;
      margin-top:10px;
    }
    .quicklinks a{
      display:inline-block;
      margin-right:12px;
      margin-top:6px;
      font-weight:600;
    }
    footer{
      margin-top:28px;
      padding-top:16px;
      border-top:1px solid #ddd;
      font-size:13px;
      color:#555;
      text-align:center;
    }
    footer a{margin:0 6px;}
  </style>
</head>

<body>
<div class="container">

  <!-- Kopf / Regeln -->
  <div class="box">
    <h1>Teilnahme am Gewinnspiel</h1>

    <p><strong>Teilnahme nur mit LIG1 in der Wallet.</strong><br>
    Zur Teilnahme musst du <strong>genau die Wallet verbinden</strong>, in der dein LIG1 liegt.
    Die <strong>Benachrichtigung im Gewinnfall</strong> erfolgt <strong>direkt an diese Wallet</strong>.</p>

    <p class="note">
      <strong>Hinweis:</strong> Nach einem Gewinn wird die Wallet automatisch
      aus der Teilnehmerliste entfernt.
      F√ºr eine weitere Teilnahme muss die Webseite erneut besucht
      und die Wallet neu verbunden werden.
    </p>

    <p class="note">
      Dieses Anmelde-Prinzip gilt <strong>nur f√ºr dieses Gewinnspiel</strong>.
      Weitere Gewinnspiele werden separat bekannt gegeben.
    </p>

    <div class="quicklinks">
      <strong>Direktlinks:</strong><br>
      <a href="https://app.uniswap.org/#/swap?chain=polygon&outputCurrency=0x92b3677ae2ea7c19aa4fa56936d11be99bcac37d"
         target="_blank" rel="noopener">
        Uniswap (POL ‚Üí LIG1, Polygon)
      </a>
      <a href="https://app.uniswap.org/#/swap?chain=polygon"
         target="_blank" rel="noopener">
        Uniswap √∂ffnen (Polygon)
      </a>
    </div>
  </div>

  <!-- Anleitungen -->
  <div class="box">

    <details open>
      <summary>Ich habe bereits LIG1</summary>
      <ol>
        <li>Verbinde <strong>genau die Wallet</strong>, in der dein LIG1 liegt.</li>
        <li>Das System pr√ºft automatisch.</li>
        <li>‚úÖ LIG1 gefunden ‚Üí <strong>Teilnahme aktiv</strong>.</li>
      </ol>
      <p class="note"><strong>Wichtig:</strong> Nur diese Wallet kann gewinnen und wird benachrichtigt.</p>
    </details>

    <details>
      <summary>Ich habe eine Wallet, aber noch kein LIG1</summary>
      <ol>
        <li>In der Wallet <strong>POL kaufen</strong> (empfohlen ab ca. <strong>10&nbsp;$</strong>).</li>
        <li><strong>Kauf in der Wallet best√§tigen</strong>.</li>
        <li>
          Zu <a href="https://app.uniswap.org/#/swap?chain=polygon&outputCurrency=0x92b3677ae2ea7c19aa4fa56936d11be99bcac37d"
                target="_blank" rel="noopener">
            Uniswap (POL ‚Üí LIG1, Polygon)
          </a> gehen.
        </li>
        <li>Oben <strong>Polygon</strong> ausw√§hlen.</li>
        <li><strong>Wallet verbinden</strong>.</li>
        <li>Bei <strong>SWAP</strong>: oben <strong>POL</strong>, unten <strong>LIG1</strong>.</li>
        <li>Betrag eingeben (ab ca. <strong>1&nbsp;$</strong> m√∂glich).</li>
        <li>Auf Uniswap best√§tigen und <strong>in der Wallet best√§tigen</strong>.</li>
        <li>Zur√ºck auf diese Seite ‚Üí <strong>Wallet verbinden</strong> ‚Üí teilnehmen.</li>
      </ol>
    </details>

    <details>
      <summary>Ich bin neu und habe noch keine Wallet</summary>
      <ol>
        <li>Wallet-App installieren (z. B. MetaMask, Base von Coinbase, Trust Wallet, Binance Wallet Web3).</li>
        <li>Wallet erstellen und die <strong>Sicherheits-W√∂rter</strong> auf Papier notieren.</li>
        <li>LIG1 in der Wallet hinzuf√ºgen (Token importieren) mit dieser Adresse:</li>
      </ol>
      <pre>0x92b3677ae2ea7c19aa4fa56936d11be99bcac37d</pre>
      <ol start="4">
        <li>In der Wallet <strong>POL kaufen</strong> (ab ca. <strong>10&nbsp;$</strong> empfohlen).</li>
        <li><strong>Kauf in der Wallet best√§tigen</strong>.</li>
        <li>
          Zu <a href="https://app.uniswap.org/#/swap?chain=polygon&outputCurrency=0x92b3677ae2ea7c19aa4fa56936d11be99bcac37d"
                target="_blank" rel="noopener">
            Uniswap (POL ‚Üí LIG1, Polygon)
          </a> gehen.
        </li>
        <li>Oben <strong>Polygon</strong> ausw√§hlen und <strong>Wallet verbinden</strong>.</li>
        <li>POL ‚Üí <strong>LIG1</strong> tauschen und <strong>in der Wallet best√§tigen</strong>.</li>
        <li>Zur√ºck hierher ‚Üí <strong>Wallet verbinden</strong> ‚Üí teilnehmen.</li>
      </ol>
    </details>

    <details>
      <summary>Wichtige Hinweise</summary>
      <ul>
        <li><strong>Gewinner m√ºssen sich f√ºr jede Auslosung neu anmelden.</strong></li>
        <li><strong>Auszahlungen erfolgen in POL.</strong></li>
        <li>Fragen bitte an <a href="mailto:project@ligone.ch">project@ligone.ch</a></li>
        <li>Das Gewinnspiel darf gern <strong>geteilt</strong> werden.</li>
      </ul>
    </details>

    <details>
      <summary>Kommendes Gewinnspiel (100 Tage Halten)</summary>
      <p>
        <strong>In K√ºrze startet ein Gewinnspiel</strong> f√ºr alle,
        die <strong>LIG1 mindestens 100 Tage lang halten</strong>.
      </p>
      <p>
        Details und Teilnahme-Regeln werden rechtzeitig bekannt gegeben.
      </p>
    </details>

    <details>
      <summary>Affiliate-Programm</summary>
      <p>Wir suchen <strong>Affiliates</strong>, die das Gewinnspiel fair weiterempfehlen m√∂chten.</p>
      <p class="note">
        Der Affiliate-Link wird in K√ºrze freigeschaltet. Wenn du Affiliate werden willst,
        melde dich kurz bei <a href="mailto:project@ligone.ch">project@ligone.ch</a>.
      </p>
    </details>

  </div>

  <!-- Teilnahme -->
  <div class="box participation">
    <button id="connectBtn">Wallet verbinden</button>
    <div id="status" class="status"></div>
  </div>

  <!-- Footer -->
  <footer>
    Unterst√ºtzt von <strong>LIGONE</strong><br>
    <a href="https://ligone-token.github.io/ligone-web/" target="_blank" rel="noopener">ligone-web</a> ¬∑
    <a href="https://ligone-token.github.io/ligone-world/" target="_blank" rel="noopener">ligone-world</a> ¬∑
    <a href="https://ligone.ch" target="_blank" rel="noopener">ligone.ch</a>
  </footer>

</div>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://unpkg.com/@walletconnect/ethereum-provider/dist/index.umd.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {

  // ===============================
  // Konfiguration
  // ===============================
  const LIG1_ADDRESS = "0x92b3677ae2ea7c19aa4fa56936d11be99bcac37d";
  const LIG1_ABI = [
    "function balanceOf(address owner) view returns (uint256)",
    "function decimals() view returns (uint8)"
  ];

  // Supabase
  const SUPABASE_URL = "https://hwpeegcsdgxgcybuosfv.supabase.co";
  const SUPABASE_KEY = "sb_publishable_LhuHoUS_DR4o2Pp3aqbNBw_IXwHo2fD";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // WalletConnect (Pflicht: Project ID einsetzen)
  const WC_PROJECT_ID = "DEINE_WALLETCONNECT_PROJECT_ID";

  const btn = document.getElementById("connectBtn");
  const statusEl = document.getElementById("status");

  // ===============================
  // Click-Handler
  // ===============================
  btn.addEventListener("click", async () => {
  statusEl.textContent = "‚è≥ Wallet wird verbunden ‚Ä¶";

  try {
    // ---- Provider w√§hlen ----
    let ethProvider;

    if (window.ethereum) {
      ethProvider = window.ethereum;
    } else {
      if (!WC_PROJECT_ID || WC_PROJECT_ID.includes("DEINE_")) {
        statusEl.textContent = "‚ùå WalletConnect nicht konfiguriert.";
        return;
      }
      ethProvider = await EthereumProvider.init({
        projectId: WC_PROJECT_ID,
        chains: [137],
        showQrModal: true
      });
    }

    const provider = new ethers.providers.Web3Provider(ethProvider, "any");

    // ---- Accounts anfordern ----
    const accounts = await provider.send("eth_requestAccounts", []);
    if (!accounts || !accounts.length) {
      statusEl.textContent = "‚ùå Keine Wallet-Adresse erhalten.";
      return;
    }

    // ---- Netzwerk pr√ºfen / anfordern ----
    const network = await provider.getNetwork();
    if (network.chainId !== 137) {
      try {
        await provider.send("wallet_switchEthereumChain", [
          { chainId: "0x89" } // Polygon
        ]);
      } catch (switchErr) {
        statusEl.textContent = "‚ùå Bitte auf Polygon wechseln.";
        return;
      }
    }

    statusEl.textContent = "üîé Wallet wird gepr√ºft ‚Ä¶";

    // ---- Adresse ----
    const signer = provider.getSigner();
    const address = await signer.getAddress();

    // ---- LIG1 CHECK ----
    const token = new ethers.Contract(LIG1_ADDRESS, LIG1_ABI, provider);
    const bal = await token.balanceOf(address);
    const dec = await token.decimals();
    const amount = Number(ethers.utils.formatUnits(bal, dec));

    if (amount <= 0) {
      statusEl.textContent = "‚ùå Kein LIG1 in dieser Wallet ‚Äì keine Teilnahme.";
      return;
    }

    // ---- Speichern ----
    statusEl.textContent = "üíæ Teilnahme wird gespeichert ‚Ä¶";
    const { error } = await supabase
      .from("participants")
      .insert([{ wallet: address }]);

    if (error && error.code !== "23505") {
      statusEl.textContent = "‚ùå Speicherung fehlgeschlagen.";
      return;
    }

    statusEl.textContent = "‚úÖ Teilnahme best√§tigt. Du bist dabei.";
    showShareModal();

  } catch (err) {
    // HIER: echter Grund sichtbar
    console.error("CONNECT ERROR:", err);
    statusEl.textContent =
      err?.message?.includes("User rejected")
        ? "‚ùå Verbindung abgebrochen."
        : "‚ùå Verbindung fehlgeschlagen.";
  }
});

</script>

<!-- Share Modal (unver√§ndert) -->
<div id="shareModal" style="
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
">
  <div style="
    background: #fff;
    padding: 24px;
    border-radius: 16px;
    max-width: 420px;
    width: 90%;
    text-align: center;
  ">
    <h2>üéâ Teilnahme best√§tigt!</h2>
    <p>Teile das Gewinnspiel und erh√∂he die Reichweite:</p>

    <input id="shareLink" value="https://ligone-token.github.io/ligone-web/gewinnspiel.html"
      readonly
      style="width:100%; padding:10px; margin-bottom:12px;">

    <button onclick="copyLink()" style="margin-bottom:10px;">üìã Link kopieren</button>
    <br>
    <a id="shareBtn" target="_blank" rel="noopener">üì£ Jetzt teilen</a>
    <br><br>
    <button onclick="closeModal()">Schlie√üen</button>
  </div>
</div>

<script>
function showShareModal() {
  const link = "https://ligone-token.github.io/ligone-web/gewinnspiel.html";
  document.getElementById("shareLink").value = link;
  document.getElementById("shareBtn").href =
    "https://t.me/share/url?url=" + encodeURIComponent(link);
  document.getElementById("shareModal").style.display = "flex";
}

function closeModal() {
  document.getElementById("shareModal").style.display = "none";
}

function copyLink() {
  const input = document.getElementById("shareLink");
  input.select();
  document.execCommand("copy");
  alert("Link kopiert ‚úÖ");
}
</script>

</body>
</html>
